\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{styles/layout}[2025/11/25 Genesis Layout Logic]

\RequirePackage{tcolorbox}
\RequirePackage{styles/colors}
\RequirePackage{styles/typography}
\RequirePackage{ocgx2} % Required for the switch button inside the header

% =======================================================================
% A. THE INVISIBLE TOC COUNTER
% =======================================================================
\newcommand{\GhostSection}[1]{%
    \stepcounter{section}%
    \addcontentsline{toc}{section}{\protect\numberline{\thesection}#1}%
}

% =======================================================================
% B. THE TAPE ERA HEADER
% =======================================================================
\newcommand{\TapeHeader}[1]{%
    \GhostSection{#1}
    \begin{tcolorbox}[
        enhanced,
        sharp corners,
        frame hidden,
        % HERE IS THE UPGRADE:
        % We use the image as the background skin
        skin=bicolor,
        colback=mit_charcoal,
        underlay={
            \begin{tcbclipinterior}
                \includegraphics[width=\tcbtextwidth, height=\tcbtextheight, keepaspectratio=false]{images/bg_tape_header.jpeg}
                % Add a dark tint overlay so text is readable
                \fill[mit_charcoal, opacity=0.8] (interior.south west) rectangle (interior.north east);
            \end{tcbclipinterior}
        },
        width=\paperwidth,
        height=2cm,
        valign=center,
        boxsep=0pt,
        left=1cm, right=1cm
    ]
        \textcolor{mit_steel}{\faCircle \hspace{2mm} \faCircleNotch \hspace{2mm} \faCircle} 
        \hfill
        \textcolor{enigma_brass}{\GenesisTitle{#1}}
        \hfill
        \switchocg{darklayer lightlayer}{
            \textcolor{mit_cardinal}{\faAdjust \hspace{1mm} \textbf{TOGGLE OPTIC}}
        }
    \end{tcolorbox}
}

\endinput