\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{components/manifest}[2025/11/25 Genesis Image Router]

\RequirePackage{graphicx}
\RequirePackage{tikz}
\RequirePackage{styles/colors}
\RequirePackage{styles/typography}

% =======================================================================
% 1. THE ROUTER (The Mapping Logic)
% =======================================================================
\newcommand{\assets}[1]{%
    \ifcsname asset@#1\endcsname%
        \csname asset@#1\endcsname%
    \else%
        example-image-a % FALLBACK if key is missing
    \fi%
}

\newcommand{\DefineAsset}[2]{%
    \expandafter\def\csname asset@#1\endcsname{images/#2}%
}

% =======================================================================
% 2. THE ASSET REGISTRY (Matched to actual files)
% =======================================================================

% Backgrounds
\DefineAsset{bg_dark}{bg_bakelite_dark.jpeg}
\DefineAsset{punchcard_bg}{bg_punchcard_light.jpeg}
\DefineAsset{tape_bg}{bg_tape_header.jpeg}

% Main Assets
\DefineAsset{rotors}{img_enigma_rotors_001.jpeg}

% Fallback for missing assets
% B. The Content Assets (Missing -> Mapped to Placeholders)
% We use 'example-image' or reuse 'rotors' so it compiles.
\DefineAsset{tape_reel}{tape_reel.jpeg} 
\DefineAsset{synapse}{synapse.jpeg}
\DefineAsset{senna_tower}{senna_tower.jpeg}

% =======================================================================
% 3. THE IMAGE FRAME WITH SHADOW
% =======================================================================
\newcommand{\GenesisImage}[3]{%
    \begin{center}
    \begin{tikzpicture}
        % Configuration
        \def\imgwidth{#3\textwidth}
        
        % The Image Node
        \node[
            inner sep=0pt,
            anchor=south west,
            draw=mit_charcoal,
            line width=1pt
        ] (theimage) at (0,0) {
            \includegraphics[width=\imgwidth]{\assets{#1}}
        };
        
        % The Shadow (Behind)
        \begin{scope}[on background layer]
            \fill[mit_charcoal!40!black] 
                ([xshift=3mm, yshift=-3mm]theimage.north west) rectangle
                ([xshift=3mm, yshift=-3mm]theimage.south east);
        \end{scope}

        % The Caption
        \node[
            anchor=north west,
            font=\sffamily\small\color{mit_steel},
            yshift=-2mm
        ] at (theimage.south west) {
            \textbf{>> #2}
        };

    \end{tikzpicture}
    \end{center}
}

\endinput